<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartCommute - BART, London Underground & Weather</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .city-tabs {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .tab-btn {
            padding: 15px 35px;
            background: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .search-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .search-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 20px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: border 0.3s;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .results-section {
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .status-banner {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .trains-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .train-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border-left: 4px solid #667eea;
        }

        .train-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .train-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .route-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .time-display {
            text-align: right;
        }

        .arrival-time {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
            line-height: 1;
        }

        .platform {
            font-size: 0.85rem;
            color: #666;
            margin-top: 4px;
        }

        .train-details {
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .detail-label {
            color: #666;
            font-size: 0.9rem;
        }

        .detail-value {
            color: #333;
            font-weight: 600;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-badge.on-time {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.delayed {
            background: #fee2e2;
            color: #991b1b;
        }

        .weather-section {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .weather-header-small {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .weather-title {
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .weather-info {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .weather-icon-small {
            font-size: 1.8rem;
        }

        .weather-temp-small {
            font-size: 1.2rem;
            font-weight: 700;
            color: #667eea;
        }

        .weather-condition-small {
            font-size: 0.85rem;
            color: #666;
        }

        .weather-details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .weather-detail {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: #666;
        }

        .aqi-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .commute-tip {
            background: white;
            border-left: 3px solid #667eea;
            padding: 15px;
            border-radius: 6px;
            margin-top: 12px;
            font-size: 0.85rem;
            color: #333;
            line-height: 1.8;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .commute-tip strong {
            color: #667eea;
            font-weight: 600;
        }
        
        .commute-tip::-webkit-scrollbar {
            width: 6px;
        }
        
        .commute-tip::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .commute-tip::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }
        
        .commute-tip::-webkit-scrollbar-thumb:hover {
            background: #5568d3;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .empty-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .weather-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }

        .forecast-day {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .scrollable-advice {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .scrollable-advice::-webkit-scrollbar {
            width: 8px;
        }
        
        .scrollable-advice::-webkit-scrollbar-track {
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
        }
        
        .scrollable-advice::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }
        
        .scrollable-advice::-webkit-scrollbar-thumb:hover {
            background: #5568d3;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .city-tabs {
                flex-wrap: wrap;
            }

            .search-form {
                grid-template-columns: 1fr;
            }

            .trains-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöá SmartCommute</h1>
            <p class="subtitle">Real-Time Transit ‚Ä¢ SF BART & London Underground ‚Ä¢ 23 Cities Weather</p>
        </header>

        <div class="city-tabs">
            <button class="tab-btn active" onclick="switchCity('bart')">San Francisco BART</button>
            <button class="tab-btn" onclick="switchCity('london')">London Underground</button>
            <button class="tab-btn" onclick="switchCity('weather')">Weather & Planning</button>
        </div>

        <div class="search-card">
            <form class="search-form" id="searchForm" onsubmit="event.preventDefault();">
                <div id="formFields"></div>
            </form>
        </div>

        <div id="results" class="results-section show"></div>
    </div>

    <script>
        let currentCity = 'bart';

        const bartStations = {
            'SBRN': 'San Bruno',
            '12TH': '12th St. Oakland City Center',
            '16TH': '16th St. Mission',
            '19TH': '19th St. Oakland',
            '24TH': '24th St. Mission',
            'ASHB': 'Ashby',
            'BALB': 'Balboa Park',
            'BAYF': 'Bay Fair',
            'EMBR': 'Embarcadero',
            'MONT': 'Montgomery St.',
            'POWL': 'Powell St.',
            'CIVC': 'Civic Center/UN Plaza'
        };

        const weatherCities = {
            // USA - Bay Area
            'San Francisco': 'San Francisco, CA',
            'Oakland': 'Oakland, CA',
            'Berkeley': 'Berkeley, CA',
            'San Jose': 'San Jose, CA',
            // USA - Other Major Cities
            'New York': 'New York, NY',
            'Los Angeles': 'Los Angeles, CA',
            'Chicago': 'Chicago, IL',
            'Seattle': 'Seattle, WA',
            // India - Major Cities
            'Delhi': 'Delhi, India',
            'Mumbai': 'Mumbai, India',
            'Bangalore': 'Bangalore, India',
            'Chennai': 'Chennai, India',
            'Kolkata': 'Kolkata, India',
            'Hyderabad': 'Hyderabad, India',
            // Europe
            'London': 'London, UK',
            'Paris': 'Paris, France',
            'Berlin': 'Berlin, Germany',
            'Amsterdam': 'Amsterdam, Netherlands',
            // Asia Pacific
            'Tokyo': 'Tokyo, Japan',
            'Singapore': 'Singapore',
            'Hong Kong': 'Hong Kong',
            'Sydney': 'Sydney, Australia',
            // Middle East
            'Dubai': 'Dubai, UAE'
        };

        const londonStations = {
            '940GZZLUKSX': "King's Cross St. Pancras",
            '940GZZLUOXC': 'Oxford Circus',
            '940GZZLUPCC': 'Piccadilly Circus',
            '940GZZLULVT': 'Liverpool Street',
            '940GZZLUWLO': 'Waterloo',
            '940GZZLUVIC': 'Victoria',
            '940GZZLUBST': 'Baker Street',
            '940GZZLULGT': 'London Bridge',
            '940GZZLUPAH': 'Paddington',
            '940GZZLUEAC': "Earl's Court",
            '940GZZLUHSK': 'High Street Kensington',
            '940GZZLUCWR': 'Canary Wharf',
            '940GZZLUSTD': 'Stratford',
            '940GZZLUCMN': 'Camden Town',
            '940GZZLUHGR': 'Highgate',
            '940GZZLUCPK': 'Clapham Common',
            '940GZZLUBKE': 'Brixton'
        };

        function switchCity(city) {
            currentCity = city;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderForm();
            showEmptyState();
        }

        function renderForm() {
            const formFields = document.getElementById('formFields');
            
            if (currentCity === 'bart') {
                formFields.innerHTML = `
                    <div class="form-group">
                        <label>Station</label>
                        <select id="station" required>
                            <option value="">Select a station...</option>
                            ${Object.entries(bartStations).map(([code, name]) => 
                                `<option value="${code}">${name}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Direction</label>
                        <select id="direction">
                            <option value="all">All Directions</option>
                            <option value="north">North</option>
                            <option value="south">South</option>
                        </select>
                    </div>
                    <button type="button" class="search-btn" onclick="handleSearch()">Find Trains</button>
                `;
            } else if (currentCity === 'london') {
                formFields.innerHTML = `
                    <div class="form-group">
                        <label>Station</label>
                        <select id="londonStation" required>
                            <option value="">Select a station...</option>
                            ${Object.entries(londonStations).map(([code, name]) => 
                                `<option value="${code}">${name}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Options</label>
                        <select id="londonOptions">
                            <option value="arrivals">Live Arrivals</option>
                            <option value="status">Line Status</option>
                        </select>
                    </div>
                    <button type="button" class="search-btn" onclick="handleSearch()">Check Tube</button>
                `;
            } else {
                formFields.innerHTML = `
                    <div class="form-group">
                        <label>City</label>
                        <select id="weatherCity" required>
                            <option value="">Select a city...</option>
                            ${Object.entries(weatherCities).map(([code, name]) => 
                                `<option value="${code}">${name}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Forecast</label>
                        <select id="forecastDays">
                            <option value="1">Current Weather</option>
                            <option value="3">3-Day Forecast</option>
                            <option value="7">7-Day Forecast</option>
                        </select>
                    </div>
                    <button type="button" class="search-btn" onclick="handleSearch()">Get Weather</button>
                `;
            }
        }

        function handleSearch() {
            showLoading();
            
            if (currentCity === 'bart') {
                displayBartResults();
            } else if (currentCity === 'london') {
                const option = document.getElementById('londonOptions')?.value || 'arrivals';
                if (option === 'status') {
                    displayLondonLineStatus();
                } else {
                    displayLondonResults();
                }
            } else {
                displayWeatherResults();
            }
        }

        async function displayBartResults() {
            const station = document.getElementById('station');
            const stationCode = station.value;
            const stationName = station.options[station.selectedIndex].text;
            const direction = document.getElementById('direction').value;
            
            if (!stationCode) {
                showEmptyState();
                return;
            }
            
            try {
                const apiUrl = `/api/bart?station=${stationCode}&direction=${direction}`;
                console.log('Fetching from:', apiUrl);

                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('API Response:', data);
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                const root = data.root;
                const station_data = root.station[0];
                const etd_list = station_data.etd || [];

                const trains = [];
                etd_list.forEach(route => {
                    const destination = route.destination;
                    const estimates = route.estimate || [];
                    const weather = route.weather; // Real weather from API
                    
                    estimates.forEach(est => {
                        trains.push({
                            destination: destination,
                            minutes: est.minutes,
                            platform: est.platform || 'N/A',
                            cars: est.length || 'N/A',
                            direction: est.direction,
                            color: est.hexcolor ? '#' + est.hexcolor : '#667eea',
                            delayed: est.delay !== '0',
                            weather: weather
                        });
                    });
                });

                if (trains.length === 0) {
                    document.getElementById('results').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üöâ</div>
                            <h2>No trains currently scheduled</h2>
                            <p>Please check back later or select a different station</p>
                        </div>
                    `;
                    return;
                }

                let html = `
                    <div class="status-banner">
                        <div class="status-dot"></div>
                        <div>
                            <strong>${stationName}</strong> - Live data with real weather from Open-Meteo ‚úì
                        </div>
                    </div>
                    <div class="trains-grid">
                `;

                trains.forEach(train => {
                    const commuteTip = getCommuteTip(train.weather, train.destination, train.minutes);
                    
                    html += `
                        <div class="train-card" style="border-left-color: ${train.color};">
                            <div class="train-header">
                                <div class="route-badge" style="background: ${train.color};">BART</div>
                                <div class="time-display">
                                    <div class="arrival-time">${train.minutes === 'Leaving' ? 'NOW' : train.minutes + ' min'}</div>
                                    <div class="platform">Platform ${train.platform}</div>
                                </div>
                            </div>
                            <div class="train-details">
                                <div class="detail-row">
                                    <span class="detail-label">Destination</span>
                                    <span class="detail-value">${train.destination}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Cars</span>
                                    <span class="detail-value">${train.cars} cars</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Direction</span>
                                    <span class="detail-value">${train.direction}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Status</span>
                                    <span class="status-badge ${train.delayed ? 'delayed' : 'on-time'}">
                                        ${train.delayed ? 'Delayed' : 'On Time'}
                                    </span>
                                </div>
                            </div>

                            <div class="weather-section">
                                <div class="weather-header-small">
                                    <div class="weather-title">
                                        üå§Ô∏è Weather at ${train.destination}
                                    </div>
                                    <div class="weather-info">
                                        <div class="weather-icon-small">${train.weather.icon}</div>
                                        <div>
                                            <div class="weather-temp-small">${train.weather.temp}¬∞C</div>
                                            <div class="weather-condition-small">${train.weather.condition}</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="weather-details-grid">
                                    <div class="weather-detail">üíß ${train.weather.humidity}% humidity</div>
                                    <div class="weather-detail">üí® ${train.weather.windSpeed} km/h</div>
                                    <div class="weather-detail">üëÅÔ∏è ${train.weather.visibility} km vis</div>
                                    <div class="weather-detail">üå°Ô∏è ${train.weather.pressure} mb</div>
                                </div>

                                <div class="aqi-badge" style="background-color: ${train.weather.aqiColor}20; color: ${train.weather.aqiColor};">
                                    ${train.weather.aqiIcon} AQI: ${train.weather.aqi} (${train.weather.aqiLevel})
                                </div>

                                <div class="commute-tip" style="line-height: 1.8;">
                                    ${commuteTip}
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                document.getElementById('results').innerHTML = html;
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('results').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ùå</div>
                        <h2>Error loading data</h2>
                        <p>${error.message}</p>
                        <p style="margin-top: 10px; font-size: 0.9rem;">Make sure the Python server is running on port 8000</p>
                    </div>
                `;
            }
        }

        async function displayLondonResults() {
            const stationSelect = document.getElementById('londonStation');
            const stationId = stationSelect?.value;
            const stationName = stationSelect?.options[stationSelect.selectedIndex].text;
            
            if (!stationId) {
                showEmptyState();
                return;
            }
            
            try {
                const apiUrl = `/api/tfl?station=${stationId}`;
                console.log('Fetching from:', apiUrl);

                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('TfL Response:', data);
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                const trains = data.trains || [];
                const weather = data.weather;

                if (trains.length === 0) {
                    document.getElementById('results').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üöá</div>
                            <h2>No trains currently scheduled</h2>
                            <p>Please check back later or select a different station</p>
                        </div>
                    `;
                    return;
                }

                let html = `
                    <div class="status-banner">
                        <div class="status-dot"></div>
                        <div>
                            <strong>${stationName}</strong> - Live data from Transport for London (TfL) ‚úì
                        </div>
                    </div>
                    
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
                        <h3 style="color: #333; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            üå§Ô∏è Current Weather at ${stationName}
                        </h3>
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
                            <div style="font-size: 3rem;">${weather.icon}</div>
                            <div>
                                <div style="font-size: 2rem; font-weight: 700; color: #667eea;">${weather.temp}¬∞C</div>
                                <div style="font-size: 1rem; color: #666;">${weather.condition}</div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px;">
                            <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                                <div style="color: #666; font-size: 0.85rem;">üíß Humidity</div>
                                <div style="font-weight: 600; color: #333; margin-top: 5px;">${weather.humidity}%</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                                <div style="color: #666; font-size: 0.85rem;">üí® Wind</div>
                                <div style="font-weight: 600; color: #333; margin-top: 5px;">${weather.windSpeed} km/h</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                                <div style="color: #666; font-size: 0.85rem;">üëÅÔ∏è Visibility</div>
                                <div style="font-weight: 600; color: #333; margin-top: 5px;">${weather.visibility} km</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                                <div style="color: #666; font-size: 0.85rem;">${weather.aqiIcon} AQI</div>
                                <div style="font-weight: 600; color: ${weather.aqiColor}; margin-top: 5px;">${weather.aqi}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="trains-grid">
                `;

                trains.forEach(train => {
                    const commuteTip = getCommuteTip(weather, train.destination, train.estimates[0]?.minutes || '5');
                    
                    html += `
                        <div class="train-card" style="border-left-color: ${train.color};">
                            <div class="train-header">
                                <div class="route-badge" style="background: ${train.color}; ${train.color === '#FFD300' || train.color === '#95CDBA' ? 'color: #000;' : ''}">${train.line}</div>
                                <div class="time-display">
                                    <div class="arrival-time">${train.estimates[0]?.minutes === 'Arriving' ? 'NOW' : train.estimates[0]?.minutes + ' min'}</div>
                                    <div class="platform">Platform ${train.estimates[0]?.platform || 'TBC'}</div>
                                </div>
                            </div>
                            <div class="train-details">
                                <div class="detail-row">
                                    <span class="detail-label">Destination</span>
                                    <span class="detail-value">${train.destination}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Line</span>
                                    <span class="detail-value">${train.line}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Next Arrivals</span>
                                    <span class="detail-value">${train.estimates.slice(0, 3).map(e => e.minutes === 'Arriving' ? 'Now' : e.minutes + ' min').join(', ')}</span>
                                </div>
                            </div>

                            <div class="weather-section">
                                <div class="weather-header-small">
                                    <div class="weather-title">
                                        üå§Ô∏è Weather at ${stationName}
                                    </div>
                                    <div class="weather-info">
                                        <div class="weather-icon-small">${weather.icon}</div>
                                        <div>
                                            <div class="weather-temp-small">${weather.temp}¬∞C</div>
                                            <div class="weather-condition-small">${weather.condition}</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="weather-details-grid">
                                    <div class="weather-detail">üíß ${weather.humidity}% humidity</div>
                                    <div class="weather-detail">üí® ${weather.windSpeed} km/h</div>
                                    <div class="weather-detail">üëÅÔ∏è ${weather.visibility} km vis</div>
                                    <div class="weather-detail">üå°Ô∏è ${weather.pressure} mb</div>
                                </div>

                                <div class="aqi-badge" style="background-color: ${weather.aqiColor}20; color: ${weather.aqiColor};">
                                    ${weather.aqiIcon} AQI: ${weather.aqi} (${weather.aqiLevel})
                                </div>

                                <div class="commute-tip" style="line-height: 1.8;">
                                    ${commuteTip}
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                document.getElementById('results').innerHTML = html;
                
            } catch (error) {
                console.error('TfL Error:', error);
                document.getElementById('results').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ùå</div>
                        <h2>Error loading TfL data</h2>
                        <p>${error.message}</p>
                        <p style="margin-top: 10px; font-size: 0.9rem;">Make sure the Python server is running</p>
                    </div>
                `;
            }
        }

        async function displayLondonLineStatus() {
            try {
                const apiUrl = `/api/tfl-status`;
                console.log('Fetching line status from:', apiUrl);

                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Line Status:', data);
                
                const lines = data.lines || [];

                let html = `
                    <div class="status-banner">
                        <div class="status-dot"></div>
                        <div>
                            <strong>London Underground</strong> - Live Line Status from TfL ‚úì
                        </div>
                    </div>
                    
                    <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
                        <h2 style="color: #333; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 2rem;">üöá</span> All Lines Status
                        </h2>
                        <div style="display: grid; gap: 15px;">
                `;

                lines.forEach(line => {
                    const isGoodService = line.severity === 10;
                    const statusColor = isGoodService ? '#10b981' : (line.severity >= 5 ? '#f59e0b' : '#ef4444');
                    const statusIcon = isGoodService ? '‚úÖ' : (line.severity >= 5 ? '‚ö†Ô∏è' : 'üö´');
                    
                    html += `
                        <div style="border: 2px solid ${line.color}; border-radius: 10px; padding: 15px; background: linear-gradient(to right, ${line.color}15, transparent);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background: ${line.color}; ${line.color === '#FFD300' || line.color === '#95CDBA' ? 'border: 2px solid #666;' : ''}"></div>
                                    <h3 style="color: #333; margin: 0; font-size: 1.2rem;">${line.name}</h3>
                                </div>
                                <div style="background: ${statusColor}20; color: ${statusColor}; padding: 6px 12px; border-radius: 6px; font-weight: 600; font-size: 0.9rem;">
                                    ${statusIcon} ${line.status}
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `
                        </div>
                        <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-left: 4px solid #667eea; border-radius: 10px;">
                            <h4 style="color: #667eea; margin-bottom: 10px; font-size: 1.1rem;">üí° Travel Tips</h4>
                            <p style="color: #333; line-height: 1.6; margin: 0;">
                                ‚Ä¢ Check for planned engineering works on weekends<br>
                                ‚Ä¢ Download the TfL Go app for real-time updates<br>
                                ‚Ä¢ Consider alternative routes during severe disruptions<br>
                                ‚Ä¢ Use contactless payment for easiest travel<br>
                                ‚Ä¢ Check station accessibility if needed
                            </p>
                        </div>
                    </div>
                `;

                document.getElementById('results').innerHTML = html;
                
            } catch (error) {
                console.error('Line Status Error:', error);
                document.getElementById('results').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ùå</div>
                        <h2>Error loading line status</h2>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function displayWeatherResults() {
            const citySelect = document.getElementById('weatherCity');
            const city = citySelect.value;
            const cityName = citySelect.options[citySelect.selectedIndex].text;
            const days = parseInt(document.getElementById('forecastDays').value);
            
            if (!city) {
                showEmptyState();
                return;
            }

            try {
                const apiUrl = `/api/weather?city=${encodeURIComponent(city)}&days=${days}`;
                console.log('Fetching weather from:', apiUrl);

                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Weather data:', data);

                const current = data.current;
                const forecast = data.forecast;

                let html = `
                    <div class="weather-card">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                            <div>
                                <h2 style="color: #333; margin-bottom: 5px;">${cityName}</h2>
                                <p style="color: #666;">Current Weather from Open-Meteo</p>
                            </div>
                            <div style="text-align: right; color: #666;">
                                <p>${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                <p>${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 30px;">
                            <div style="font-size: 4rem;">${current.icon}</div>
                            <div>
                                <div style="font-size: 3.5rem; font-weight: 700; color: #667eea;">${current.temp}¬∞C</div>
                                <div style="font-size: 1.2rem; color: #666; text-transform: capitalize;">${current.condition}</div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 25px; padding-top: 25px; border-top: 2px solid #f0f0f0;">
                            <div style="text-align: center;">
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">üíß Humidity</div>
                                <div style="font-size: 1.3rem; font-weight: 600; color: #333;">${current.humidity}%</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">üí® Wind Speed</div>
                                <div style="font-size: 1.3rem; font-weight: 600; color: #333;">${current.windSpeed} km/h</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">üëÅÔ∏è Visibility</div>
                                <div style="font-size: 1.3rem; font-weight: 600; color: #333;">${current.visibility} km</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">üå°Ô∏è Pressure</div>
                                <div style="font-size: 1.3rem; font-weight: 600; color: #333;">${current.pressure} mb</div>
                            </div>
                        </div>

                        <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-left: 4px solid #667eea; border-radius: 10px; padding: 20px; margin-top: 20px;">
                            <h4 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem; font-weight: 600;">üöá Detailed Commute Recommendations</h4>
                            <div class="scrollable-advice" style="color: #333; line-height: 1.8; font-size: 0.9rem;">${getCommuteAdvice(current)}</div>
                        </div>
                    </div>
                `;

                if (days > 1 && forecast.length > 0) {
                    html += `
                        <div class="weather-card">
                            <h3 style="color: #333; margin-bottom: 20px;">${days}-Day Forecast</h3>
                            <div class="forecast-grid">
                    `;

                    const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                    forecast.forEach((day, index) => {
                        const date = new Date(day.date);
                        const dayName = index === 0 ? 'Today' : daysOfWeek[date.getDay()];

                        html += `
                            <div class="forecast-day">
                                <div style="font-weight: 600; margin-bottom: 10px; color: #333;">${dayName}</div>
                                <div style="font-size: 2rem; margin: 10px 0;">${day.icon}</div>
                                <div style="font-size: 1.2rem; font-weight: 600; color: #667eea;">
                                    ${day.tempMax}¬∞ / ${day.tempMin}¬∞
                                </div>
                                <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">${day.condition}</div>
                                <div style="font-size: 0.75rem; color: #999; margin-top: 5px;">
                                    üíß ${day.precipProb}% rain
                                </div>
                            </div>
                        `;
                    });

                    html += `
                            </div>
                        </div>
                    `;
                }

                document.getElementById('results').innerHTML = html;

            } catch (error) {
                console.error('Weather error:', error);
                document.getElementById('results').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ùå</div>
                        <h2>Error loading weather data</h2>
                        <p>${error.message}</p>
                        <p style="margin-top: 10px; font-size: 0.9rem;">Make sure the Python server is running</p>
                    </div>
                `;
            }
        }

        function getCommuteTip(weather, destination, minutes) {
            const tips = [];
            const arrivalTime = minutes === 'Leaving' ? 0 : parseInt(minutes);
            
            // === TEMPERATURE & CLOTHING TIPS ===
            if (weather.temp > 32) {
                tips.push('üå°Ô∏è <strong>Extreme Heat Alert:</strong> Wear light, breathable cotton or linen clothing. Bring a wide-brimmed hat and sunglasses. Apply sunscreen (SPF 30+). Carry a water bottle - you\'ll need to drink 500ml+ during your commute.');
            } else if (weather.temp > 28) {
                tips.push('‚òÄÔ∏è <strong>Hot Weather:</strong> Light-colored, loose-fitting clothes recommended. Tank tops or short sleeves ideal. Bring sunglasses and stay in shade when possible. Keep hydrated with at least 250ml of water.');
            } else if (weather.temp > 20) {
                tips.push('üå§Ô∏è <strong>Warm & Pleasant:</strong> T-shirt and light pants/shorts are perfect. You might want sunglasses. Great weather for your commute!');
            } else if (weather.temp > 15) {
                tips.push('üëï <strong>Mild Temperature:</strong> Long sleeves or a light sweater recommended. Jeans or light pants are good. You might want a light jacket you can remove if it gets warmer.');
            } else if (weather.temp > 10) {
                tips.push('üß• <strong>Cool Weather:</strong> Wear a medium jacket or sweater. Long pants required. Consider bringing a scarf. Layering is key - wear a t-shirt under your jacket.');
            } else if (weather.temp > 5) {
                tips.push('‚ùÑÔ∏è <strong>Cold Weather:</strong> Heavy jacket or winter coat essential. Wear warm layers (thermal undershirt + sweater + coat). Long pants, closed shoes. Bring gloves and a beanie/hat. Scarf highly recommended.');
            } else {
                tips.push('ü•∂ <strong>Freezing Conditions:</strong> Heavy winter coat mandatory. Multiple layers: thermal underwear + fleece + insulated jacket. Wear thick socks, insulated boots, winter gloves, scarf, and warm hat covering ears. Protect exposed skin.');
            }
            
            // === RAIN & PRECIPITATION ===
            if (weather.condition.includes('Rain') || weather.condition.includes('rain')) {
                tips.push('‚òî <strong>Rain Expected:</strong> Bring an umbrella or wear a waterproof raincoat. Wear water-resistant shoes or boots - avoid canvas shoes. Keep electronics in waterproof bags. Allow 10-15 extra minutes as trains may run slower in wet conditions.');
            } else if (weather.condition.includes('Drizzle') || weather.condition.includes('drizzle')) {
                tips.push('üå¶Ô∏è <strong>Light Drizzle:</strong> A light rain jacket or umbrella should suffice. Watch for slippery station platforms.');
            } else if (weather.condition.includes('Thunder') || weather.condition.includes('Storm')) {
                tips.push('‚õàÔ∏è <strong>Thunderstorm Warning:</strong> Seek indoor shelter immediately when possible. Avoid open platforms if lightning is visible. Expect significant delays (20-30 min). Pack emergency snacks and charge your phone.');
            } else if (weather.condition.includes('Snow')) {
                tips.push('üå®Ô∏è <strong>Snow Conditions:</strong> Wear insulated waterproof boots with good traction. Dress in waterproof layers. Expect major delays (30+ min). Check BART alerts before leaving. Platforms will be icy - walk carefully.');
            }
            
            // === WIND CONDITIONS ===
            if (weather.windSpeed > 40) {
                tips.push('üí® <strong>Dangerous Winds:</strong> Secure all loose items. Avoid umbrellas (they\'ll break). Wear a hood or hat with chin strap. Expect 15-20 min delays on elevated tracks. Hold handrails firmly on platforms.');
            } else if (weather.windSpeed > 30) {
                tips.push('üå¨Ô∏è <strong>Strong Winds:</strong> Compact umbrella only (regular ones will invert). Secure bags and hats. Expect minor delays on outdoor sections (5-10 min). Stand away from platform edge.');
            } else if (weather.windSpeed > 20) {
                tips.push('üí® <strong>Breezy Conditions:</strong> Keep loose items secured. Light jackets might not provide enough warmth due to wind chill.');
            }
            
            // === VISIBILITY & FOG ===
            if (weather.visibility < 3) {
                tips.push('üå´Ô∏è <strong>Poor Visibility/Heavy Fog:</strong> Trains running 10-15 min slower for safety. Allow extra 20 minutes for your journey. Use station lights to navigate. Keep phone charged for maps/updates.');
            } else if (weather.visibility < 5) {
                tips.push('üåÅ <strong>Moderate Fog:</strong> Reduced visibility conditions. Allow extra 10 minutes. Stay alert on platforms.');
            }
            
            // === AIR QUALITY INDEX (AQI) HEALTH TIPS ===
            if (weather.aqi > 200) {
                tips.push(`üò® <strong>Unhealthy AQI (${weather.aqi}):</strong> <span style="color: #ef4444;">HEALTH ALERT!</span> Wear an N95 or KN95 mask (surgical masks insufficient). Take short, shallow breaths outdoors. If you have asthma, use your inhaler preventatively. Consider postponing travel if you have respiratory issues. Avoid outdoor platforms - wait inside when possible. Don't exercise or run to catch trains.`);
            } else if (weather.aqi > 150) {
                tips.push(`üò∑ <strong>Unhealthy for Sensitive (AQI ${weather.aqi}):</strong> If you have asthma, allergies, or respiratory conditions, wear a KN95 mask. Children, elderly, and pregnant women should limit outdoor time. Consider waiting indoors until your train arrives (use arrival apps). Avoid deep breathing.`);
            } else if (weather.aqi > 100) {
                tips.push(`üòê <strong>Moderate AQI (${weather.aqi}):</strong> Air quality acceptable for most, but sensitive individuals may want to wear a mask. If you're experiencing breathing difficulty, consider a cloth mask or wait indoors. Reduce strenuous activity.`);
            } else if (weather.aqi > 50) {
                tips.push(`üòä <strong>Good AQI (${weather.aqi}):</strong> Air quality is satisfactory. No special precautions needed. Enjoy your commute!`);
            } else {
                tips.push(`üåü <strong>Excellent AQI (${weather.aqi}):</strong> Outstanding air quality! Perfect conditions for commuting. Feel free to walk or bike for short distances.`);
            }
            
            // === ARRIVAL TIME BASED TIPS ===
            if (arrivalTime === 0) {
                tips.push('üèÉ‚Äç‚ôÇÔ∏è <strong>Boarding Now:</strong> Train is leaving! Run if you must, but be careful. If you miss it, next train should arrive soon.');
            } else if (arrivalTime <= 2) {
                tips.push(`‚è∞ <strong>${arrivalTime} min away:</strong> Head to the platform now. Check which platform and position yourself near the doors. Have your Clipper card ready.`);
            } else if (arrivalTime <= 5) {
                tips.push(`‚è±Ô∏è <strong>${arrivalTime} min away:</strong> Make your way to the platform. Good time to check the weather at ${destination || 'your destination'} and prepare accordingly. Get your payment card ready.`);
            } else if (arrivalTime <= 10) {
                tips.push(`üïê <strong>${arrivalTime} min wait:</strong> You have time. Use the restroom if needed. Grab a coffee or snack. Check emails. Then head to platform in 5 minutes.`);
            } else if (arrivalTime <= 15) {
                tips.push(`üì± <strong>${arrivalTime} min wait:</strong> Plenty of time. Relax, check your schedule, reply to messages. Consider the current weather at ${destination || 'your destination'} - conditions might be different when you arrive.`);
            } else {
                tips.push(`‚è≥ <strong>${arrivalTime} min wait:</strong> Long wait ahead. Find a seat in the station. This is perfect time to: check work emails, read, or plan your day. Weather might change before arrival.`);
            }
            
            // === DESTINATION SPECIFIC CONTEXT ===
            if (destination) {
                const destWeather = `Based on current conditions at ${destination}: ${weather.temp}¬∞C and ${weather.condition.toLowerCase()}`;
                
                if (weather.temp > 25) {
                    tips.push(`üéØ <strong>At ${destination}:</strong> ${destWeather}. Once you arrive, you'll want to stay in air-conditioned areas. Most buildings and shops have AC. BART stations can be warm - expect temperature change when exiting.`);
                } else if (weather.temp < 12) {
                    tips.push(`üéØ <strong>At ${destination}:</strong> ${destWeather}. When you arrive, it will feel colder than inside the train. Put on your jacket before exiting. Wind may be stronger at street level than in the station.`);
                } else {
                    tips.push(`üéØ <strong>At ${destination}:</strong> ${destWeather}. Pleasant conditions upon arrival. The area should be comfortable for walking around.`);
                }
            }
            
            // === GENERAL SAFETY & COMFORT ===
            if (weather.humidity > 80) {
                tips.push('üíß <strong>High Humidity:</strong> It will feel warmer than the actual temperature. You may sweat more. Bring tissues or a small towel. Stay hydrated.');
            }
            
            // Combine all tips into one detailed message
            return tips.join('<br><br>');
        }

        function getCommuteAdvice(weather) {
            const advice = [];
            
            // Temperature-based advice
            if (weather.temp > 35) {
                advice.push('üî• <strong>Extreme Heat Warning:</strong> Very dangerous conditions. Avoid outdoor commuting during peak sun hours (10am-4pm) if possible. If you must go out: wear loose, light-colored cotton/linen clothing, wide-brimmed hat, and sunglasses. Apply SPF 50+ sunscreen every 2 hours. Carry 1L+ water and drink regularly - don\'t wait until you\'re thirsty. Take frequent breaks in air-conditioned spaces. Watch for heat exhaustion symptoms: dizziness, excessive sweating, rapid heartbeat. Consider rescheduling non-essential travel.');
            } else if (weather.temp > 30) {
                advice.push('‚òÄÔ∏è <strong>Very Hot Weather:</strong> Uncomfortable for prolonged outdoor activity. Choose air-conditioned transit options (metro/subway over outdoor buses). Wear breathable fabrics - avoid polyester and tight clothing. Bring a refillable water bottle (aim for 500ml-750ml during commute). Sunglasses and hat recommended. Apply sunscreen if walking more than 10 minutes. Avoid dark colors that absorb heat. Take breaks in shade.');
            } else if (weather.temp > 25) {
                advice.push('üå§Ô∏è <strong>Warm & Pleasant:</strong> Great commuting weather! Light clothing is perfect - t-shirts, shorts, summer dresses are all good. If walking or biking for short distances (under 20 minutes), this is ideal weather. Bring sunglasses for sun protection. Stay hydrated with occasional water sips. All transit modes operating normally.');
            } else if (weather.temp > 18) {
                advice.push('üëï <strong>Mild Temperature:</strong> Perfect commuting conditions! Light layers recommended - you can always remove a jacket. T-shirt + light jacket or sweater combination works well. All outdoor and indoor transit options comfortable. Great weather for walking, biking, or using any transit mode. No special precautions needed.');
            } else if (weather.temp > 12) {
                advice.push('üß• <strong>Cool Weather:</strong> Dress in layers for comfort - wear a medium jacket over long sleeves. Jeans or long pants recommended. You might want to bring a light scarf. Morning and evening will be cooler than midday - plan accordingly. Underground/indoor transit stations will feel warmer than outdoor platforms. Consider bringing a jacket you can easily carry when indoors.');
            } else if (weather.temp > 5) {
                advice.push('‚ùÑÔ∏è <strong>Cold Weather:</strong> Bundle up! Wear a warm coat or winter jacket, preferably insulated. Layer your clothing: base layer (thermal/long underwear) + middle layer (sweater/fleece) + outer layer (jacket). Long pants essential. Bring gloves, scarf, and a hat/beanie. Underground transit options will feel warmer - you may want to remove outer layers once inside. Keep extremities covered - cold hands and ears are uncomfortable. Allow extra time as cold can slow movement.');
            } else if (weather.temp > 0) {
                advice.push('ü•∂ <strong>Freezing Conditions:</strong> Dangerous cold! Heavy winter coat mandatory - ensure it\'s wind-resistant and insulated. Multiple layers essential: thermal underwear + warm shirt + fleece/wool sweater + heavy coat. Wear thick socks and insulated boots. Winter gloves (not fingerless), warm scarf covering neck, and hat covering ears are non-negotiable. Protect your face if windy. Limit time outdoors - wait inside stations when possible. Frostbite risk on exposed skin after 30 minutes. Keep hands/feet moving to maintain circulation.');
            } else {
                advice.push('‚ö†Ô∏è <strong>Extreme Cold Alert:</strong> Life-threatening conditions! Minimize outdoor exposure - only travel if absolutely necessary. Wear maximum insulation: thermal base layers + multiple middle layers + heavy-duty winter parka. Insulated, waterproof boots essential. Wear face mask/balaclava to protect face. Double-layer gloves if possible. Frostbite possible in under 10 minutes on exposed skin. Keep emergency supplies in your bag. Check all transit is operating before leaving - many services may be delayed or cancelled.');
            }
            
            // Precipitation advice
            if (weather.condition.includes('Thunder') || weather.condition.includes('Storm')) {
                advice.push('‚õàÔ∏è <strong>Thunderstorm Alert:</strong> Dangerous conditions! Avoid all travel if possible - storms can cause flooding and fallen trees. If you must travel: stay indoors until lightning passes (wait 30 min after last thunder). Avoid open spaces and tall objects. Don\'t use umbrellas during lightning (metal attracts electricity). Expect major transit delays (30-60+ min) and possible service cancellations. Keep phone charged for emergency alerts. Pack emergency snacks and water. Monitor weather apps constantly. Underground/metro is safest option.');
            } else if (weather.condition.includes('Rain') || weather.condition.includes('rain')) {
                advice.push('‚òî <strong>Rain Expected:</strong> Wet weather commute ahead. Essential items: sturdy umbrella (compact ones for trains/buses) + waterproof jacket with hood + water-resistant shoes/boots (avoid canvas or suede). Put electronics (phone, laptop) in waterproof bags or plastic. Allow 15-20 extra minutes - traffic slower, platforms slippery, more people using transit. Underground/subway preferred over buses. Watch for puddles at crosswalks. Carry tissues for drying off. Floors inside stations will be slippery - walk carefully. Have backup transportation plan in case of flooding.');
            } else if (weather.condition.includes('Snow')) {
                advice.push('üå®Ô∏è <strong>Snow Conditions:</strong> Difficult commuting weather! Wear waterproof boots with deep treads (slip risk is high). Dress warmly and in waterproof layers. Expect MAJOR delays (45+ min typical) - many services cancelled or rerouted. Leave 2x your normal commute time. Check transit alerts before leaving home. Platforms, sidewalks, and stairs will be icy - hold railings. Bring emergency supplies (snacks, water, phone charger) in case you\'re stranded. Consider working from home if possible. If driving, ensure winter tires and keep emergency kit in car.');
            }
            
            // Wind conditions
            if (weather.windSpeed > 50) {
                advice.push('üí® <strong>Dangerous Wind Warning:</strong> Severe conditions! Travel not recommended unless emergency. Flying debris hazard - avoid walking near trees, buildings, or construction sites. Regular umbrellas WILL break - don\'t use them. Seek lowest floor in buildings during transit. Above-ground trains/buses likely cancelled or severely delayed (60+ min). Stay indoors and away from windows when possible. If you must travel, wear secure hood instead of hat. Be prepared for sudden gusts when rounding corners.');
            } else if (weather.windSpeed > 35) {
                advice.push('üå¨Ô∏è <strong>High Wind Alert:</strong> Very windy conditions affecting transit. Expect 20-30 min delays on outdoor/elevated routes. Don\'t use umbrellas (they\'ll invert/break). Wear a hooded jacket with zippers/buttons instead of loose clothing. Secure all loose items - bags should have zippers, not open tops. When on platforms, stand well back from edge - sudden gusts can be dangerous. Consider underground transit options which are unaffected by wind. Cyclists should NOT ride in these conditions.');
            } else if (weather.windSpeed > 25) {
                advice.push('üí® <strong>Windy Conditions:</strong> Breezy weather affecting outdoor comfort. Use a compact, sturdy umbrella if needed (cheap ones will break). Wind chill makes it feel colder than actual temperature - add an extra layer. Minor delays possible on outdoor routes (5-10 min). Keep bags closed and secure. If wearing a hat, ensure it fits snugly. Underground/enclosed transit options more comfortable.');
            }
            
            // Visibility conditions
            if (weather.visibility < 2) {
                advice.push('üå´Ô∏è <strong>Severe Fog/Low Visibility:</strong> Extremely poor visibility (<2km). All transportation significantly affected. Expect 30+ min delays - trains/buses operating at reduced speeds for safety. If driving, use fog lights and reduce speed to 40kmph max. Leave 2x normal travel time. Wait inside stations - hard to see approaching vehicles. Use reflective clothing if walking. Keep phone GPS on for navigation. Check transit apps constantly for delays. Consider postponing non-essential travel.');
            } else if (weather.visibility < 5) {
                advice.push('üåÅ <strong>Reduced Visibility:</strong> Foggy or hazy conditions. Expect 10-15 min delays as services slow down for safety. Extra caution at crosswalks - drivers\' visibility reduced. If walking, wear bright/reflective clothing. Use pedestrian signals carefully. Allow extra time. Underground transit unaffected and preferred.');
            }
            
            // Add general safety tips
            if (weather.temp > 25 || weather.temp < 10) {
                advice.push('‚è∞ <strong>Timing Tip:</strong> Weather extremes increase transit crowding as more people use indoor options. Consider traveling slightly earlier or later than peak rush hour (7-9am, 5-7pm) for more comfortable journey and available seating.');
            }
            
            advice.push('üì± <strong>Stay Informed:</strong> Download transit apps for real-time updates. Set up service alerts for your routes. Check weather forecasts the night before to plan your outfit and route accordingly. Always have a backup plan (alternative route or working from home).');
            
            return advice.join('<br><br>');
        }

        function showLoading() {
            const loadingText = {
                bart: 'Fetching real-time BART data...',
                london: 'Fetching live TfL data from London...',
                weather: 'Fetching weather data from Open-Meteo...'
            };
            
            document.getElementById('results').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>${loadingText[currentCity] || 'Loading...'}</p>
                </div>
            `;
        }

        function showEmptyState() {
            const messages = {
                bart: {
                    icon: 'üöá',
                    title: 'Select your BART station',
                    text: 'Get real-time train arrivals with accurate weather data'
                },
                london: {
                    icon: 'üöá',
                    title: 'Select your Tube station',
                    text: 'Live arrivals and line status from Transport for London'
                },
                weather: {
                    icon: 'üå§Ô∏è',
                    title: 'Select a city',
                    text: 'View detailed weather forecasts and commute planning'
                }
            };
            
            const msg = messages[currentCity] || messages.bart;
            
            document.getElementById('results').innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">${msg.icon}</div>
                    <h2>${msg.title}</h2>
                    <p>${msg.text}</p>
                </div>
            `;
        }

        // Initialize
        renderForm();
        showEmptyState();
    </script>
</body>
</html>
